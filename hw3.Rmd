---
title: "esm204_hw3"
author: "David Segan"
date: "5/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# ------------
# attach packages and read in csv
# ------------
library(tidyverse)
library(janitor)
library(stargazer)
library(wesanderson)

# csv is demand of gasoline for high and low income consumer groups
gas_df <- read_csv("Homework 3 Data.csv") %>% 
  clean_names()

# add aggregate demand column
# convert gallons to thousands of gallons
gas_df_agg <- gas_df %>% 
  mutate(q_low_gallons = q_low_gallons) %>% 
  mutate(q_high_gallons = q_high_gallons) %>% 
  mutate(q_agg_gallons = (q_low_gallons + q_high_gallons))
```

```{r}
# Assigning variables
gas_price <- 3
extern_country <- 1.5
extern_world <- 0.5

```

```{r}
# Linear models to estimate demand curves from data

# low income
lm_low <- lm(price_dollars ~ q_low_gallons, data = gas_df_agg)

# high income
lm_high <- lm(price_dollars ~ q_high_gallons, data = gas_df_agg)

# aggregate 
lm_agg <- lm(price_dollars ~ q_agg_gallons, data = gas_df_agg)

lm_agg


```


```{r}
# If price equals $3, what quantity is demanded?

q_agg_eq <- (gas_price - lm_agg$coefficients[1])/lm_agg$coefficients[2]

q_agg_eq

# Supply curve
# Begins at $0 and 0 quantity, has a slope of 3/q_agg

gas_price/q_agg_eq

# make a list of possible gallons consumed
q_gasoline <- seq(0,600000, by = 10000)
# add it into a df
q_gasoline_df <- data.frame(q_gasoline)
# calculate marginal cost at each q (supply curve)
q_gasoline_supply <- q_gasoline_df %>% 
  mutate(mc = (gas_price/q_agg_eq)*q_gasoline)



```

```{r}
# Demand and supply functions p(q)

dem_low_p <- function(q) {p = lm_low$coefficients[1] + lm_low$coefficients[2]*q}
dem_high_p <-function(q) {p = lm_high$coefficients[1] + lm_high$coefficients[2]*q}
dem_agg_p <-function(q) {p = lm_agg$coefficients[1] + lm_agg$coefficients[2]*q}
supply_p <-function(q) {p = (gas_price/q_agg_eq)*q}
q <- 0:800000

# Graph for visual
  
ggplot() +
  stat_function(aes(q, color = "low income"), fun = dem_low_p, size = 1, show.legend = TRUE) + 
  stat_function(aes(q, color = "high income"), fun = dem_high_p, size = 1, show.legend = TRUE) + 
  stat_function(aes(q, color = "agg"), fun = dem_agg_p, size = 1, show.legend = TRUE) + 
  stat_function(aes(q, color = "supply"), fun = supply_p, size = 1, show.legend = TRUE) +
  scale_y_continuous(limits = c(0,20)) +
  scale_x_continuous(labels = scales::comma)


```